FROM python:3.10-slim

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential \
    curl \
    && rm -rf /var/lib/apt/lists/*

COPY services/frontend/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY services/frontend/ .

# 한국어 번역 파일 추가
RUN mkdir -p /app/.chainlit/translations
RUN echo '{\
  "default": {\
    "header": {\
      "notConversationPage": "자동차 정비 도우미",\
      "conversationPage": "자동차 정비 도우미"\
    },\
    "actions": {\
      "clear": "대화 초기화",\
      "settings": "설정",\
      "moreInfo": "더 많은 정보",\
      "lessInfo": "적은 정보",\
      "clearChat": "대화를 초기화하시겠습니까?",\
      "upload": "업로드",\
      "cancel": "취소",\
      "confirm": "확인"\
    },\
    "inputs": {\
      "placeholder": "메시지 입력..."\
    },\
    "output": {\
      "clear": "대화 초기화",\
      "copy": "복사",\
      "copied": "복사됨",\
      "loading": "로딩 중...",\
      "thinking": "생각 중..."\
    }\
  }\
}' > /app/.chainlit/translations/ko.json

# 예제 .env 파일 생성 (실제 배포 시 볼륨 마운트로 대체)
RUN echo "# Azure OpenAI 설정\n\
AZURE_OPENAI_API_KEY=\n\
AZURE_OPENAI_ENDPOINT=https://your-resource-name.openai.azure.com/\n\
AZURE_OPENAI_API_VERSION=2023-05-15\n\
AZURE_OPENAI_DEPLOYMENT_NAME=\n\
AZURE_OPENAI_MODEL=gpt-4-turbo\n\
\n\
# 기본 LLM 설정\n\
DEFAULT_LLM_SERVICE=azure-openai\n\
DEFAULT_LLM_MODEL=gpt-4-turbo\n\
\n\
# LLM 응답 설정\n\
LLM_TEMPERATURE=0.7\n\
LLM_MAX_TOKENS=1000\n\
\n\
# 시스템 설정\n\
MAX_RETRIES=5\n\
RETRY_DELAY=2.0\n\
REQUEST_TIMEOUT=30.0\n\
PYTHONUNBUFFERED=1" > /app/.env.example

# 환경 변수 설정
ENV PYTHONUNBUFFERED=1

EXPOSE 8000

CMD ["chainlit", "run", "app.py", "--host", "0.0.0.0", "--port", "8000"] 