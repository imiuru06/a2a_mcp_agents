openapi: 3.0.3
info:
  title: MCP Server API
  description: |
    MCP(Model Context Protocol) Server API는 AI 모델과 외부 도구 및 데이터 소스 간의 통합을 위한 
    표준화된 인터페이스를 제공합니다. 이 API를 통해 도구 실행, 취소, 상태 조회 등의 기능을 사용할 수 있습니다.
  version: 1.0.0
  contact:
    name: A2A-MCP Team
    email: a2a-mcp-team@example.com

servers:
  - url: https://mcp-api.example.com/v1
    description: 프로덕션 서버
  - url: https://staging-mcp-api.example.com/v1
    description: 스테이징 서버
  - url: http://localhost:8002/v1
    description: 로컬 개발 서버

tags:
  - name: tools
    description: 도구 관련 엔드포인트
  - name: runs
    description: 도구 실행 관련 엔드포인트
  - name: context
    description: 컨텍스트 관련 엔드포인트
  - name: health
    description: 상태 확인 엔드포인트

paths:
  /tools:
    get:
      summary: 사용 가능한 도구 목록 조회
      description: 현재 MCP 서버에서 사용 가능한 모든 도구 목록을 반환합니다.
      operationId: listTools
      tags:
        - tools
      parameters:
        - name: category
          in: query
          description: 도구 카테고리로 필터링
          required: false
          schema:
            type: string
            example: data_processing
        - name: page
          in: query
          description: 페이지 번호
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: 페이지당 항목 수
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: 도구 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolListResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /tools/{tool_name}:
    get:
      summary: 특정 도구 정보 조회
      description: 지정된 이름의 도구에 대한 상세 정보를 반환합니다.
      operationId: getTool
      tags:
        - tools
      parameters:
        - name: tool_name
          in: path
          description: 도구 이름
          required: true
          schema:
            type: string
            example: analyze_cpu_issue
        - name: version
          in: query
          description: 도구 버전 (지정하지 않으면 최신 버전)
          required: false
          schema:
            type: string
            example: 1.2.0
      responses:
        '200':
          description: 도구 정보 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToolDefinition'
        '404':
          description: 도구를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /runs:
    post:
      summary: 도구 실행 요청
      description: 지정된 도구를 실행하는 요청을 생성합니다.
      operationId: createRun
      tags:
        - runs
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunRequest'
      responses:
        '202':
          description: 실행 요청이 성공적으로 수락됨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunResponse'
        '400':
          description: 잘못된 요청 형식
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 도구를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codegen-request-body-name: runRequest

  /runs/{run_id}:
    get:
      summary: 실행 상태 조회
      description: 특정 실행의 상태 정보를 조회합니다.
      operationId: getRun
      tags:
        - runs
      parameters:
        - name: run_id
          in: path
          description: 실행 ID
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: 실행 상태 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RunStatusResponse'
        '404':
          description: 실행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: 실행 취소
      description: 진행 중인 실행을 취소합니다.
      operationId: cancelRun
      tags:
        - runs
      parameters:
        - name: run_id
          in: path
          description: 실행 ID
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '202':
          description: 취소 요청이 성공적으로 수락됨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancellationResponse'
        '404':
          description: 실행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 이미 완료되었거나 취소된 실행
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /runs/{run_id}/stream:
    get:
      summary: 실행 상태 스트림 연결
      description: |
        SSE(Server-Sent Events)를 통해 실행 상태를 실시간으로 스트리밍합니다.
        진행률, 로그, 중간 결과 등을 포함합니다.
      operationId: streamRunStatus
      tags:
        - runs
      parameters:
        - name: run_id
          in: path
          description: 실행 ID
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: 스트림 연결 성공
          content:
            text/event-stream:
              schema:
                type: string
                format: binary
                description: SSE 스트림
        '404':
          description: 실행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /context/{run_id}:
    get:
      summary: 실행 컨텍스트 조회
      description: 특정 실행의 컨텍스트 정보를 조회합니다.
      operationId: getRunContext
      tags:
        - context
      parameters:
        - name: run_id
          in: path
          description: 실행 ID
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
      responses:
        '200':
          description: 컨텍스트 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextResponse'
        '404':
          description: 실행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: 실행 컨텍스트 업데이트
      description: 특정 실행의 컨텍스트 정보를 업데이트합니다.
      operationId: updateRunContext
      tags:
        - context
      parameters:
        - name: run_id
          in: path
          description: 실행 ID
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContextUpdateRequest'
      responses:
        '200':
          description: 컨텍스트 업데이트 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextResponse'
        '400':
          description: 잘못된 요청 형식
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 실행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      x-codegen-request-body-name: contextUpdate

  /health:
    get:
      summary: 서비스 상태 확인
      description: MCP Server 서비스의 상태를 확인합니다.
      operationId: checkHealth
      tags:
        - health
      responses:
        '200':
          description: 서비스가 정상 작동 중
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: 서비스 이용 불가
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ToolDefinition:
      type: object
      required:
        - name
        - description
        - parameters
        - return_schema
        - version
      properties:
        name:
          type: string
          description: 도구 이름
          example: analyze_cpu_issue
        description:
          type: string
          description: 도구 설명
          example: CPU 사용률 문제를 분석하고 해결책을 제안합니다.
        parameters:
          type: object
          description: 도구 매개변수 스키마 (JSON Schema 형식)
          example:
            type: object
            properties:
              host_id:
                type: string
                description: 호스트 ID
              time_range:
                type: object
                properties:
                  start:
                    type: string
                    format: date-time
                  end:
                    type: string
                    format: date-time
            required: [host_id]
        return_schema:
          type: object
          description: 반환값 스키마 (JSON Schema 형식)
          example:
            type: object
            properties:
              issue_found:
                type: boolean
              issue_type:
                type: string
              recommendations:
                type: array
                items:
                  type: string
        version:
          type: string
          description: 도구 버전
          example: 1.2.0
        is_stateful:
          type: boolean
          description: 상태 유지 여부
          default: false
          example: false
        category:
          type: string
          description: 도구 카테고리
          example: diagnostics
        tags:
          type: array
          items:
            type: string
          description: 태그 목록
          example: ["cpu", "performance", "monitoring"]
        average_runtime:
          type: number
          description: 평균 실행 시간(초)
          example: 5.2
        created_at:
          type: string
          format: date-time
          description: 생성 시간
          example: '2023-05-01T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          description: 마지막 업데이트 시간
          example: '2023-05-10T15:30:00Z'

    ToolListResponse:
      type: object
      required:
        - tools
        - total
      properties:
        tools:
          type: array
          description: 도구 목록
          items:
            $ref: '#/components/schemas/ToolSummary'
        total:
          type: integer
          description: 전체 도구 수
          example: 42
        page:
          type: integer
          description: 현재 페이지
          example: 1
        limit:
          type: integer
          description: 페이지당 항목 수
          example: 20
        categories:
          type: array
          items:
            type: string
          description: 사용 가능한 카테고리 목록
          example: ["diagnostics", "data_processing", "networking", "security"]

    ToolSummary:
      type: object
      required:
        - name
        - description
        - version
      properties:
        name:
          type: string
          description: 도구 이름
          example: analyze_cpu_issue
        description:
          type: string
          description: 도구 설명
          example: CPU 사용률 문제를 분석하고 해결책을 제안합니다.
        version:
          type: string
          description: 도구 버전
          example: 1.2.0
        category:
          type: string
          description: 도구 카테고리
          example: diagnostics
        tags:
          type: array
          items:
            type: string
          description: 태그 목록
          example: ["cpu", "performance", "monitoring"]
        average_runtime:
          type: number
          description: 평균 실행 시간(초)
          example: 5.2

    RunRequest:
      type: object
      required:
        - tool_name
        - parameters
      properties:
        tool_name:
          type: string
          description: 실행할 도구 이름
          example: analyze_cpu_issue
        tool_version:
          type: string
          description: 도구 버전 (지정하지 않으면 최신 버전)
          example: 1.2.0
        parameters:
          type: object
          description: 도구에 전달할 매개변수
          example:
            host_id: server-123
            time_range:
              start: '2023-05-01T00:00:00Z'
              end: '2023-05-01T12:00:00Z'
        context_id:
          type: string
          description: 연결된 컨텍스트 ID (선택 사항)
          example: ctx-abc123
        timeout:
          type: integer
          description: 실행 제한 시간(초)
          minimum: 1
          maximum: 3600
          default: 300
          example: 300
        priority:
          type: integer
          description: 실행 우선순위 (낮을수록 높은 우선순위)
          minimum: 1
          maximum: 10
          default: 5
          example: 3
        callback_url:
          type: string
          format: uri
          description: 실행 완료 시 콜백할 URL (선택 사항)
          example: https://example.com/callbacks/mcp

    RunResponse:
      type: object
      required:
        - run_id
        - tool_name
        - status
      properties:
        run_id:
          type: string
          format: uuid
          description: 실행 ID
          example: 123e4567-e89b-12d3-a456-426614174000
        tool_name:
          type: string
          description: 도구 이름
          example: analyze_cpu_issue
        tool_version:
          type: string
          description: 도구 버전
          example: 1.2.0
        status:
          type: string
          enum: [queued, running, completed, failed, cancelled]
          description: 실행 상태
          example: queued
        queue_position:
          type: integer
          description: 대기열 위치 (대기 중인 경우)
          example: 2
        estimated_start:
          type: string
          format: date-time
          description: 예상 시작 시간 (대기 중인 경우)
          example: '2023-05-01T12:35:10Z'
        stream_url:
          type: string
          description: 상태 스트림 URL
          example: /v1/runs/123e4567-e89b-12d3-a456-426614174000/stream
        created_at:
          type: string
          format: date-time
          description: 생성 시간
          example: '2023-05-01T12:35:00Z'

    RunStatusResponse:
      type: object
      required:
        - run_id
        - tool_name
        - status
      properties:
        run_id:
          type: string
          format: uuid
          description: 실행 ID
          example: 123e4567-e89b-12d3-a456-426614174000
        tool_name:
          type: string
          description: 도구 이름
          example: analyze_cpu_issue
        tool_version:
          type: string
          description: 도구 버전
          example: 1.2.0
        status:
          type: string
          enum: [queued, running, completed, failed, cancelled]
          description: 실행 상태
          example: running
        progress:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: 진행률(%)
          example: 45.5
        result:
          type: object
          description: 실행 결과 (완료된 경우)
          example:
            issue_found: true
            issue_type: "high_cpu_load"
            recommendations: [
              "불필요한 프로세스 종료",
              "리소스 제한 설정",
              "서버 스케일 업"
            ]
        error:
          type: object
          description: 오류 정보 (실패한 경우)
          properties:
            code:
              type: string
              description: 오류 코드
              example: TOOL_EXECUTION_ERROR
            message:
              type: string
              description: 오류 메시지
              example: 도구 실행 중 예외가 발생했습니다.
            details:
              type: object
              description: 추가 오류 정보
        logs:
          type: array
          items:
            $ref: '#/components/schemas/LogEntry'
          description: 최근 로그 항목 (최대 10개)
        created_at:
          type: string
          format: date-time
          description: 생성 시간
          example: '2023-05-01T12:35:00Z'
        started_at:
          type: string
          format: date-time
          description: 시작 시간
          example: '2023-05-01T12:35:05Z'
        completed_at:
          type: string
          format: date-time
          description: 완료 시간 (완료된 경우)
          example: null
        context_id:
          type: string
          description: 연결된 컨텍스트 ID
          example: ctx-abc123

    LogEntry:
      type: object
      required:
        - timestamp
        - level
        - message
      properties:
        timestamp:
          type: string
          format: date-time
          description: 로그 시간
          example: '2023-05-01T12:35:15Z'
        level:
          type: string
          enum: [debug, info, warning, error]
          description: 로그 레벨
          example: info
        message:
          type: string
          description: 로그 메시지
          example: CPU 사용률 데이터 분석 중...
        progress:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: 진행률(%)
          example: 30.0

    CancellationResponse:
      type: object
      required:
        - run_id
        - status
      properties:
        run_id:
          type: string
          format: uuid
          description: 실행 ID
          example: 123e4567-e89b-12d3-a456-426614174000
        status:
          type: string
          enum: [cancelling, cancelled]
          description: 취소 상태
          example: cancelling
        message:
          type: string
          description: 상태 메시지
          example: 실행 취소 요청이 수락되었습니다. 리소스 정리 중...
        timestamp:
          type: string
          format: date-time
          description: 응답 시간
          example: '2023-05-01T12:36:00Z'

    ContextResponse:
      type: object
      required:
        - context_id
        - run_id
      properties:
        context_id:
          type: string
          description: 컨텍스트 ID
          example: ctx-abc123
        run_id:
          type: string
          format: uuid
          description: 실행 ID
          example: 123e4567-e89b-12d3-a456-426614174000
        data:
          type: object
          description: 컨텍스트 데이터
          example:
            analyzed_hosts: ["server-123"]
            previous_issues: ["high_cpu_load", "memory_leak"]
        created_at:
          type: string
          format: date-time
          description: 생성 시간
          example: '2023-05-01T12:35:00Z'
        updated_at:
          type: string
          format: date-time
          description: 마지막 업데이트 시간
          example: '2023-05-01T12:35:30Z'
        expires_at:
          type: string
          format: date-time
          description: 만료 시간
          example: '2023-05-02T12:35:00Z'

    ContextUpdateRequest:
      type: object
      required:
        - data
      properties:
        data:
          type: object
          description: 업데이트할 컨텍스트 데이터
          example:
            analyzed_hosts: ["server-123", "server-456"]
            previous_issues: ["high_cpu_load", "memory_leak", "disk_full"]
        merge:
          type: boolean
          description: 기존 데이터와 병합 여부
          default: true
          example: true
        extend_expiry:
          type: boolean
          description: 만료 시간 연장 여부
          default: false
          example: true

    HealthResponse:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [ok, degraded, down]
          description: 서비스 상태
          example: ok
        version:
          type: string
          description: 서비스 버전
          example: 1.0.0
        uptime:
          type: integer
          description: 서비스 가동 시간(초)
          example: 3600
        timestamp:
          type: string
          format: date-time
          description: 응답 시간
          example: '2023-05-01T12:35:00Z'
        stats:
          type: object
          description: 서비스 통계
          properties:
            active_runs:
              type: integer
              description: 활성 실행 수
              example: 5
            queued_runs:
              type: integer
              description: 대기 중인 실행 수
              example: 3
            tools_loaded:
              type: integer
              description: 로드된 도구 수
              example: 42
        dependencies:
          type: object
          description: 의존성 서비스 상태
          example:
            database: ok
            container_runtime: ok
            tool_registry: ok

    ErrorResponse:
      type: object
      required:
        - error_code
        - message
      properties:
        error_code:
          type: string
          description: 오류 코드
          example: TOOL_NOT_FOUND
        message:
          type: string
          description: 오류 메시지
          example: 지정된 도구를 찾을 수 없습니다.
        details:
          type: object
          description: 추가 오류 정보
          example:
            tool_name: analyze_cpu_issue
            version: 1.2.0
        request_id:
          type: string
          description: 요청 추적 ID
          example: req-abc123
        timestamp:
          type: string
          format: date-time
          description: 오류 발생 시간
          example: '2023-05-01T12:34:58Z'

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - BearerAuth: []
  - ApiKeyAuth: [] 