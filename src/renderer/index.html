<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
  <title>자동차 정비 에이전트 서비스</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <!-- 네비게이션 바 -->
    <nav class="navbar">
      <div class="navbar-brand">🚗 자동차 정비 에이전트 서비스</div>
      <div class="navbar-menu">
        <button @click="activeTab = 'new-task'" :class="{ active: activeTab === 'new-task' }">새 작업 등록</button>
        <button @click="activeTab = 'tasks'" :class="{ active: activeTab === 'tasks' }">작업 현황</button>
        <button @click="activeTab = 'agents'" :class="{ active: activeTab === 'agents' }">에이전트 정보</button>
        <button @click="activeTab = 'settings'" :class="{ active: activeTab === 'settings' }">설정</button>
      </div>
    </nav>

    <!-- 메인 컨텐츠 영역 -->
    <main class="main-content">
      <!-- 새 작업 등록 탭 -->
      <div v-if="activeTab === 'new-task'" class="tab-content">
        <h2>새 차량 문제 등록</h2>
        <div class="form-container">
          <div class="form-row">
            <div class="form-group">
              <label for="customer-id">고객 ID</label>
              <input type="text" id="customer-id" v-model="newTask.customer_id" placeholder="고객 ID">
            </div>
            <div class="form-group">
              <label for="vehicle-id">차량 ID</label>
              <input type="text" id="vehicle-id" v-model="newTask.vehicle_id" placeholder="차량 ID">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="make">제조사</label>
              <select id="make" v-model="newTask.vehicle_info.make">
                <option value="현대">현대</option>
                <option value="기아">기아</option>
                <option value="BMW">BMW</option>
                <option value="벤츠">벤츠</option>
                <option value="아우디">아우디</option>
                <option value="도요타">도요타</option>
                <option value="혼다">혼다</option>
                <option value="포드">포드</option>
                <option value="기타">기타</option>
              </select>
            </div>
            <div class="form-group">
              <label for="model">모델</label>
              <input type="text" id="model" v-model="newTask.vehicle_info.model" placeholder="모델">
            </div>
            <div class="form-group">
              <label for="year">연식</label>
              <input type="number" id="year" v-model="newTask.vehicle_info.year" min="1990" max="2025" placeholder="연식">
            </div>
          </div>
          <div class="form-group">
            <label>증상 선택</label>
            <div class="checkbox-group">
              <div class="checkbox-item" v-for="symptom in availableSymptoms" :key="symptom">
                <input type="checkbox" :id="symptom" :value="symptom" v-model="newTask.symptoms">
                <label :for="symptom">{{ symptom }}</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="description">문제 상세 설명</label>
            <textarea id="description" v-model="newTask.description" rows="4" placeholder="문제 상세 설명"></textarea>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" @click="submitTask" :disabled="isSubmitting">
              {{ isSubmitting ? '등록 중...' : '작업 등록' }}
            </button>
          </div>
        </div>
        <div v-if="taskSuccess" class="success-message">
          <p>작업이 성공적으로 등록되었습니다! 작업 ID: {{ taskSuccess.task_id }}</p>
          <button class="btn btn-secondary" @click="viewTask(taskSuccess.task_id)">작업 보기</button>
        </div>
        <div v-if="taskError" class="error-message">
          <p>작업 등록 실패: {{ taskError }}</p>
        </div>
      </div>

      <!-- 작업 현황 탭 -->
      <div v-if="activeTab === 'tasks'" class="tab-content">
        <h2>작업 현황</h2>
        <div class="controls">
          <button class="btn btn-secondary" @click="refreshTasks">작업 목록 새로고침</button>
          <div v-if="tasksLoading" class="loader"></div>
        </div>
        <div v-if="tasks.length === 0 && !tasksLoading" class="empty-state">
          <p>등록된 작업이 없습니다. '새 작업 등록' 탭에서 작업을 등록해주세요.</p>
        </div>
        <div v-else class="tasks-container">
          <table class="tasks-table">
            <thead>
              <tr>
                <th>작업 ID</th>
                <th>제목</th>
                <th>상태</th>
                <th>담당자</th>
                <th>생성일</th>
                <th>조회</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="task in tasks" :key="task.task_id">
                <td>{{ task.task_id }}</td>
                <td>{{ task.title }}</td>
                <td :class="'status-' + task.status">{{ task.status }}</td>
                <td>{{ task.assigned_to || '-' }}</td>
                <td>{{ formatDate(task.created_at) }}</td>
                <td>
                  <button class="btn btn-small" @click="viewTaskDetails(task.task_id)">상세보기</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div v-if="selectedTask" class="task-details">
          <h3>{{ selectedTask.title }}</h3>
          <div class="details-row">
            <div class="details-label">상태:</div>
            <div :class="'status-' + selectedTask.status">{{ selectedTask.status }}</div>
          </div>
          <div class="details-row">
            <div class="details-label">담당자:</div>
            <div>{{ selectedTask.assigned_to || '-' }}</div>
          </div>
          <div class="details-row">
            <div class="details-label">생성일:</div>
            <div>{{ formatDate(selectedTask.created_at) }}</div>
          </div>
          <div class="history-section" v-if="selectedTask.history && selectedTask.history.length > 0">
            <h4>작업 기록</h4>
            <div class="history-item" v-for="(entry, index) in selectedTask.history" :key="index">
              <div class="history-agent">{{ entry.agent_id }}</div>
              <div class="history-message">{{ entry.message }}</div>
            </div>
          </div>
          <div class="part-order-section" v-if="selectedTask.status === 'in_progress' || selectedTask.status === 'pending'">
            <h4>부품 주문</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="part-number">부품 번호</label>
                <select id="part-number" v-model="partOrder.part_number">
                  <option value="12345">12345 - 스파크 플러그</option>
                  <option value="12346">12346 - 에어 필터</option>
                  <option value="12347">12347 - 연료 인젝터</option>
                  <option value="12348">12348 - 산소 센서</option>
                </select>
              </div>
              <div class="form-group">
                <label for="quantity">수량</label>
                <input type="number" id="quantity" v-model="partOrder.quantity" min="1" max="10">
              </div>
              <button class="btn btn-primary" @click="orderPart" :disabled="isOrdering">
                {{ isOrdering ? '주문 중...' : '부품 주문' }}
              </button>
            </div>
            <div v-if="orderSuccess" class="success-message">
              <p>부품 주문 성공! 주문 ID: {{ orderSuccess.order_id }}</p>
            </div>
            <div v-if="orderError" class="error-message">
              <p>부품 주문 실패: {{ orderError }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 에이전트 정보 탭 -->
      <div v-if="activeTab === 'agents'" class="tab-content">
        <h2>에이전트 정보</h2>
        <div class="controls">
          <button class="btn btn-secondary" @click="refreshAgents">에이전트 정보 새로고침</button>
          <div v-if="agentsLoading" class="loader"></div>
        </div>
        <div v-if="agents.length === 0 && !agentsLoading" class="empty-state">
          <p>에이전트 정보를 불러올 수 없습니다.</p>
        </div>
        <div v-else class="agents-container">
          <div class="agent-card" v-for="agent in agents" :key="agent.agent_id">
            <h3>{{ agent.name }} ({{ agent.agent_id }})</h3>
            <p class="agent-description">{{ agent.description }}</p>
            <div class="agent-skills">
              <h4>기술:</h4>
              <ul>
                <li v-for="skill in agent.skills" :key="skill">{{ skill }}</li>
              </ul>
            </div>
            <div class="agent-modalities">
              <h4>지원 모달리티:</h4>
              <p>{{ agent.supported_modalities.join(', ') }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- 설정 탭 -->
      <div v-if="activeTab === 'settings'" class="tab-content">
        <h2>설정</h2>
        <div class="form-container">
          <div class="form-group">
            <label for="api-url">API 서버 URL</label>
            <input type="text" id="api-url" v-model="apiUrl" placeholder="http://localhost:8000">
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" @click="saveSettings">설정 저장</button>
          </div>
        </div>
        <div v-if="settingsSuccess" class="success-message">
          <p>설정이 저장되었습니다.</p>
        </div>
      </div>
    </main>

    <!-- 푸터 -->
    <footer class="footer">
      <p>© 2025 자동차 정비 에이전트 서비스 | A2A 및 MCP 프로토콜 기반</p>
    </footer>
  </div>

  <!-- Vue.js CDN -->
  <script src="../assets/vue.js"></script>
  <!-- 메인 스크립트 -->
  <script src="app.js"></script>
</body>
</html> 